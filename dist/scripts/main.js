"use strict";var app=angular.module("myApp",["ngRoute","myApp.config","myApp.filters","myApp.services","myApp.directives","myApp.controllers"]);app.config(["$routeProvider",function(e){e.when("/survey",{templateUrl:"partials/survey.html",controller:"surveyCtrl"}),e.when("/welcome",{templateUrl:"partials/welcome.html",controller:"welcomeCtrl"}),e.when("/login",{templateUrl:"partials/login.html",controller:"loginCtrl"}),e.when("/demoSwipe",{templateUrl:"partials/demoSwipe.html",controller:"demoSwipeCtrl"}),e.when("/result",{templateUrl:"partials/result.html",controller:"resultCtrl",resolve:{currentAuth:["Auth",function(e){return e.$requireAuth()}]}}),e.otherwise({redirectTo:"/welcome"})}]),app.run(["FBURL",function(e){"https://angularfire-survey.firebaseio.com/surveys"===e&&angular.element(document.body).html("<h1>Please configure app/js/config.js before running!</h1>")}]),app.run(["$rootScope","$location","Auth",function(e,t,r){r.$onAuth(function(t){e.authData=t}),e.logout=function(){r.$unauth(),t.path("/survey")},e.isActive=function(e){return e===t.path()},e.$on("$routeChangeError",function(e,r,n,a){"AUTH_REQUIRED"===a&&t.path("/survey")})}]);var app=angular.module("myApp.config",["ngRoute"]);app.constant("FBURL","https://ihgsurvey.firebaseio.com/surveys");var app=angular.module("myApp.services",["ngRoute","firebase"]);app.value("version","1.0.1"),app.factory("Auth",["$firebaseAuth","FBURL",function(e,t){var r=new Firebase(t);return e(r)}]);var app=angular.module("myApp.controllers",["ngRoute"]);app.controller("welcomeCtrl",["$scope","FBURL","$firebaseArray","$location",function(e,t,r,n){e.takeSurvey=function(){$("#tnc").modal("show")},e.go=function(e){n.path("/survey")}}]),app.controller("surveyCtrl",["$scope","FBURL","$firebaseArray",function(e,t,r){var n=new Firebase(t),a=$("#addButton"),o=$(".scroll-down"),i=$(".scrollIndex");a.hide(),e.surveys=r(n),e.timestamp=(new Date).getTime(),e.successInfo=!1,$("#travel").modal("show"),e.openTravelPrefer=function(){$("#travel").unbind("hidden"),$("#travel").modal("show")},e.openDailyPrefer=function(){$("#daily").modal("show")},e.swiper={},e.preferReward=function(t){return"both"==e.formData.preferReward?!0:t==e.formData.preferReward},e.onReadySurvey=function(t){t.on("onReachEnd",function(){o.hide(),a.show()}),t.on("onSlideChangeStart",function(t){t.activeIndex+1==3&&("travel"==e.formData.preferReward&&($("#travel").unbind("hidden"),$("#travel").modal("show")),"daily"==e.formData.preferReward&&$("#daily").modal("show"),"both"==e.formData.preferReward&&($("#travel").modal("show"),$("#travel").on("hidden.bs.modal",function(e){$("#daily").modal("show")}))),t.activeIndex+1<t.slides.length&&(o.show(),a.hide(),i.text(t.activeIndex+1))})},e.formData={name:"",memberId:"",phoneNumber:"",memberType:"",preferReward:"travel",preferTreatment:"both",comment:"eg.vip免费送.....",timestamp:e.timestamp},e.updateRating=function(t){e.formData.rating=t},e.isTrue=function(t){return console.log(t),e.formData[t]},e.addSurvey=function(){e.formData.name||e.formData.memberId||e.formData.phoneNumber?(a.button("loading"),e.surveys.$add(e.formData).then(function(){$("#survey").modal("hide"),a.button("reset").hide(),e.successInfo=!0,$(".swiper-container").hide()})["catch"](function(e){alert("请正确填写您的联系信息"),$("#contactInfo").modal("show")})):(alert("请正确填写您的联系信息"),$("#contactInfo").modal("show"))}}]),app.controller("loginCtrl",["$scope","$location","Auth",function(e,t,r){e.email="admin@mydomain.com",e.password="password",e.login=function(){e.authData=null,e.error=null;var n=$("#loginButton").button("loading");r.$authWithPassword({email:e.email,password:e.password}).then(function(r){e.authData=r,t.path("/result"),n.button("reset")})["catch"](function(t){e.error=t,n.button("reset")})}}]),app.controller("resultCtrl",["$scope","FBURL","$firebaseArray",function(e,t,r){var n=new Firebase(t);e.results=r(n)}]);var app=angular.module("myApp.filters",["ngRoute"]);app.filter("interpolate",["version",function(e){return function(t){return String(t).replace(/\%VERSION\%/gm,e)}}]),angular.module("myApp.directives",["ngRoute","ksSwiper"]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).directive("btnRadio",["buttonConfig",function(e){var t=e.activeClass||"active",r=e.toggleEvent||"click";return{require:"ngModel",link:function(e,n,a,o){o.$render=function(){n.toggleClass(t,angular.equals(o.$modelValue,a.btnRadio))},n.bind(r,function(){n.hasClass(t)||e.$apply(function(){o.$setViewValue(a.btnRadio),o.$render()})})}}}]).directive("starRating",function(){return{restrict:"A",template:"<ul class='rating'><li ng-repeat='star in stars' ng-click='toggle($index)'><span class='glyphicon' ng-class='{\"glyphicon-star\": star.filled, \"glyphicon-star-empty\": !star.filled}'></span></li></ul>",scope:{ratingValue:"=",max:"=",readonly:"@",onRatingSelected:"&"},link:function(e,t,r){var n=function(){e.stars=[];for(var t=0;t<e.max;t++)e.stars.push({filled:t<e.ratingValue})};e.toggle=function(t){e.readonly&&"true"===e.readonly||(e.ratingValue=t+1,e.onRatingSelected({rating:t+1}))},e.$watch("ratingValue",function(e,t){t&&n()})}}}).directive("ksSwiperContainer",function(){return{restrict:"AE",replace:!0,link:function(e,t,r){var n=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.children(".swiper-container").css({height:.5*n+"px"})}}});