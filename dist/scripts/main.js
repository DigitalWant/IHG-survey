"use strict";var app=angular.module("myApp",["ngRoute","myApp.config","myApp.filters","myApp.services","myApp.directives","myApp.controllers"]);app.config(["$routeProvider",function(e){e.when("/survey",{templateUrl:"partials/survey.html",controller:"surveyCtrl"}),e.when("/welcome",{templateUrl:"partials/welcome.html",controller:"welcomeCtrl"}),e.when("/login",{templateUrl:"partials/login.html",controller:"loginCtrl"}),e.when("/demoSwipe",{templateUrl:"partials/demoSwipe.html",controller:"demoSwipeCtrl"}),e.when("/result",{templateUrl:"partials/result.html",controller:"resultCtrl",resolve:{currentAuth:["Auth",function(e){return e.$requireAuth()}]}}),e.otherwise({redirectTo:"/welcome"})}]),app.run(["FBURL",function(e){"https://angularfire-survey.firebaseio.com/surveys"===e&&angular.element(document.body).html("<h1>Please configure app/js/config.js before running!</h1>")}]),app.run(["$rootScope","$location","Auth",function(e,t,n){n.$onAuth(function(t){e.authData=t}),e.logout=function(){n.$unauth(),t.path("/survey")},e.isActive=function(e){return e===t.path()},e.$on("$routeChangeError",function(e,n,r,o){"AUTH_REQUIRED"===o&&t.path("/survey")})}]);var app=angular.module("myApp.config",["ngRoute"]);app.constant("FBURL","https://ihgsurvey.firebaseio.com/surveys");var app=angular.module("myApp.services",["ngRoute","firebase"]);app.value("version","1.0.1"),app.factory("Auth",["$firebaseAuth","FBURL",function(e,t){var n=new Firebase(t);return e(n)}]);var app=angular.module("myApp.controllers",["ngRoute"]);app.controller("welcomeCtrl",["$scope","FBURL","$firebaseArray","$location",function(e,t,n,r){$("#tnc").on("show.bs.modal",function(){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),t=e-90-130;$(".modal-body").height(t)}),e.takeSurvey=function(){$("#tnc").modal("show")},e.go=function(e){r.path("/survey")}}]),app.controller("surveyCtrl",["$scope","FBURL","$firebaseArray",function(e,t,n){var r=new Firebase(t),o=$("#addButton,.sendbtn"),a=$(".scroll-down"),i=$(".scrollIndex"),l=0,s=5,u=!0,c=$(".alert-danger");c.hide(),o.hide(),e.surveys=n(r),e.timestamp=(new Date).getTime(),e.successInfo=!1,e.openTravelPrefer=function(){$("#travel").unbind("hidden"),$("#travel").modal("show")},e.openDailyPrefer=function(){$("#daily").modal("show")},e.swiper={},e.preferReward=function(t){return"both"==e.formData.preferReward?!0:t==e.formData.preferReward},e.onReadySurvey=function(t,n){t.on("onReachEnd",function(){a.hide(),o.show()}),t.on("onSlideChangeEnd",function(t){""==e.formData.memberType?(t.slideTo(0),c.show()):""==e.formData.preferReward&&t.activeIndex>1?(t.slideTo(1),c.show()):""==e.formData.preferTreatment&&t.activeIndex>3&&(t.slideTo(3),c.show()),console.log(""==e.formData.comment),""==e.formData.comment&&t.activeIndex>3&&(console.log("comment is empty"),c.show())}),t.on("onSlideChangeStart",function(t){l=t.activeIndex+1,c.hide(),3==l&&1==u&&(u=!1,"travel"==e.formData.preferReward&&($("#travel").unbind("hidden"),$("#travel").modal("show"),$("#travel").on("hidden.bs.modal",function(e){t.slideTo(3)})),"daily"==e.formData.preferReward&&($("#daily").unbind("hidden"),$("#daily").modal("show"),$("#daily").on("hidden.bs.modal",function(e){t.slideTo(3)})),"both"==e.formData.preferReward&&($("#travel").modal("show"),$("#travel").on("hidden.bs.modal",function(e){$("#daily").modal("show")}),$("#daily").on("hidden.bs.modal",function(e){t.slideTo(3)}))),l<t.slides.length?(a.show(),o.hide(),i.text(l)):l==t.slides.length&&i.text(l)})},e.formData={name:"",memberId:"",phoneNumber:"",memberType:"",preferReward:"",preferTreatment:"",comment:"",timestamp:e.timestamp},e.updateRating=function(t){e.formData.rating=t},e.isTrue=function(t){return e.formData[t]},e.lastQuestion=function(){return l==s},e.addSurvey=function(){e.formData.name&&""!=e.formData.memberId&&""!=e.formData.phoneNumber?(o.button("loading"),e.surveys.$add(e.formData).then(function(){o.button("reset").hide(),e.successInfo=!0,$(".swiper-container,hr,h4.modal-title").hide(),$("#survey").modal("hide"),$("#contactInfo").modal("hide")})["catch"](function(e){alert("请正确填写您的联系信息"),$("#contactInfo").modal("show")})):($("#contactInfo").modal("show"),$("#contactInfo").addClass("highlight"))}}]),app.controller("loginCtrl",["$scope","$location","Auth",function(e,t,n){e.email="admin@mydomain.com",e.password="password",e.login=function(){e.authData=null,e.error=null;var r=$("#loginButton").button("loading");n.$authWithPassword({email:e.email,password:e.password}).then(function(n){e.authData=n,t.path("/result"),r.button("reset")})["catch"](function(t){e.error=t,r.button("reset")})}}]),app.controller("resultCtrl",["$scope","FBURL","$firebaseArray",function(e,t,n){var r=new Firebase(t);e.results=n(r)}]);var app=angular.module("myApp.filters",["ngRoute"]);app.filter("interpolate",["version",function(e){return function(t){return String(t).replace(/\%VERSION\%/gm,e)}}]),angular.module("myApp.directives",["ngRoute","ksSwiper"]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).directive("btnRadio",["buttonConfig",function(e){var t=e.activeClass||"active",n=e.toggleEvent||"click";return{require:"ngModel",link:function(e,r,o,a){a.$render=function(){r.toggleClass(t,angular.equals(a.$modelValue,o.btnRadio))},r.bind(n,function(){r.hasClass(t)||e.$apply(function(){a.$setViewValue(o.btnRadio),a.$render()})})}}}]).directive("starRating",function(){return{restrict:"A",template:"<ul class='rating'><li ng-repeat='star in stars' ng-click='toggle($index)'><span class='glyphicon' ng-class='{\"glyphicon-star\": star.filled, \"glyphicon-star-empty\": !star.filled}'></span></li></ul>",scope:{ratingValue:"=",max:"=",readonly:"@",onRatingSelected:"&"},link:function(e,t,n){var r=function(){e.stars=[];for(var t=0;t<e.max;t++)e.stars.push({filled:t<e.ratingValue})};e.toggle=function(t){e.readonly&&"true"===e.readonly||(e.ratingValue=t+1,e.onRatingSelected({rating:t+1}))},e.$watch("ratingValue",function(e,t){t&&r()})}}}).directive("ksSwiperContainer",function(){return{restrict:"AE",replace:!0,link:function(e,t,n){var r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.children(".swiper-container").css({height:.47*r+"px"})}}});